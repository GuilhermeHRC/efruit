<!DOCTYPE html>
<html lang="br">
<head>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta charset="utf-8">
    <title>E-Fruit</title>
</head>
<body>
  <nav class="d-none navbar fixed-bottom navbar-light bg-light only-mobile">
    <div class="container-fluid">
      <div class="row">
        <div class="col-4 d-flex justify-content-center align-items-center flex-column">
          <a href="#"><img src="img/home-icon.png" alt=""></a>
          <p class="text-menu-mobile">Home</p>
        </div>
        <div class="text-menu-mobile col-4 d-flex justify-content-center align-items-center flex-column">
          <a href="#"><img src="img/shop-icon.png" alt=""></a>
          <p>Carrinho</p>
        </div>
        <div class="text-menu-mobile col-4 d-flex justify-content-center align-items-center flex-column">
          <a href="#"><img src="img/profile-icon.png" alt=""></a>
          <p>Perfil</p>
        </div>
      </div>
    </div>
  </nav>
  <div class='modal-background' id='modal-background'>
  </div>
  <div class='modal-container' id='modal'>
    <div class='product-container'>
      <strong>Página do Produto</strong>
      <div class='product-info'>
        <img class='product-image' src='img\apple.png' alt='Apple' />
        <strong id=product-name> Maça Fuji </strong>
        <div class="item-prop-container">
          <div class='align-item-prop'>
            <span>
              Preço por kilo:
            </span>
            <span id='price-kg'>
              R$ 16,47
            </span>
          </div>
          <div class='align-item-prop'>
            <span>
              Peso estimado:
            </span>
            <span id='weight'>
              300g
            </span>
          </div>
        </div>
        <div class='quantity-selector'>
          <div onclick="subQuantity()">
            -
          </div>
          <div id='quantity'>
            1
          </div>
          <div onclick="addQuantity()">
            +
          </div>
        </div>
      </div>
      <div class='item-prop-container'>
        <div class='align-item-prop'>
          <strong>
            Subtotal:
          </strong>
          <strong id='subtotal'>
            R$ 16,47
          </strong>
        </div>
      </div>
      <div id='add-to-cart-btn' onclick="addToCart()" class='to-cart-button'>
        ADICIONAR
      </div>
    </div>
  </div>

  <div class="top-bar">
    <spam class="only-web">Frete grátis nas compras acima de R$99 | Entrega segura | Até 6x sem juros</spam>
    <div class="top-bar-nav">
      <div></div>
      <h1 class="small-logo center-mobile">e-fruit</h1>
      <ul class="only-web top-bar-links">
        <li><a id='admin-page-link' href="admin.html" class="small-icon" style='visibility: hidden;'><i class="fa fa-user"></i></a></li>
        <li><a href="#" class="small-icon"><i class="fa fa-search"></i></a></li>
        <li><span onclick='logout()' style='cursor: pointer;' class="small-icon">Logout</span></li>
        <li><a href="#" class="small-icon"><i class="fa fa-shopping-cart"></i></a></li>
      </ul>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="#">Comprar por categoria <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Frutas orgânicas</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Frutas silvestres</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Frutas secas</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Frutas exóticas</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="container-fluid ">
    <div class="row slider-fruit">
      <div class="display-none-720 col-4 d-flex justify-content-center align-items-center">
        <p class="left-slider">E-FRUIT</p>
        <p class="left-slider">FRIDAY</p>
      </div>
      <div class="col-md-4 col-12">
        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
          </ol>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="img\frutas-slider.png" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="img\frutas-slider.png" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="img\frutas-slider.png" class="d-block w-100" alt="...">
            </div>
          </div>
        </div>
      </div>
      <div class="display-none-720 col-4 d-flex justify-content-center align-items-center flex-column">
        <p class="left-slider">50%</p>
        <p class="text-center">EM TODAS AS<br>FRUTAS VERMELHAS</p>
      </div>

    </div>
    <hr>
    <div
      id="products-list"
      class="row"
    >
      <div class="col-lg-9 col-12">
        <div class="row mb-5 mt-4">
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12 flex-row d-flex align-items-center justify-content-around mt-5">
            <div class="card d-flex align-items-center">
              <img class="card-img-top" src="img\apple.png" alt="Card image cap">
              <div class="card-body text-center">
                <h5 class="card-title">Maça Fuji</h5>
                <p class="card-text price mt-4"><strong>R$ 1,98/Kg</strong><br>Compra a cada 500g</p>
              </div>
              <div class="card-body">
                <strong><p onclick="openProductInfoModal()" class="card-link">ADICIONAR AO CARRINHO</p></strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.onload = function () {
      const user = localStorage.getItem("efruit:user");

      if (!user) {
        window.location.href = "index.html";
      }
      else {
        localStorage.setItem('cart', JSON.stringify({}));
      }

      // test only
      const parsedUser = JSON.parse(user);
      if (parsedUser['email'] == 'admin@efruit.com') {
        const adminPageBtn = document.getElementById('admin-page-link');
        adminPageBtn.style.visibility = 'visible';
      }
    }

    const modalBackground = document.getElementById('modal-background');
    modalBackground.onclick = (e) => {
      e.preventDefault();

      const body = document.getElementsByTagName('body')[0];
      body.classList.remove('stop-scrolling');

      const modalBackground = document.getElementById('modal-background');
      const modal = document.getElementById('modal');

      modalBackground.style.visibility = 'hidden';
      modal.style.visibility = 'hidden';
    };

    const openProductInfoModal = () => {

      const modalBackground = document.getElementById('modal-background');
      const modal = document.getElementById('modal');

      modalBackground.style.visibility = 'visible';
      modal.style.visibility = 'visible';

      document.documentElement.scrollTop = 0;

      const body = document.getElementsByTagName('body')[0];
      body.classList.add('stop-scrolling');
    };

    const addToCart = () => {
      const name = document.getElementById('product-name').innerText;
      const price = parseFloat(document.getElementById('price-kg')
                      .innerText.replace(',', '.').replace('R$', ''));
      const weight = parseFloat(document.getElementById('weight')
                      .innerText.replace(/g/, ''));
      const quantity = parseInt(document.getElementById('quantity').innerText);

      const cart = JSON.parse(localStorage.cart);

      if (!cart.hasOwnProperty(name)) {
        cart[name] = {
          "price": price,
          "weight": weight,
          "quantity": 0
        };
      }

      cart[name].quantity += quantity;
      localStorage.setItem('cart', JSON.stringify(cart));

      const addToCartButton = document.getElementById('add-to-cart-btn');
      addToCartButton.classList.add('added-to-cart');
      addToCartButton.innerText = 'ADICIONADO';
      setTimeout(() => {
        addToCartButton.classList.remove('added-to-cart');
        addToCartButton.innerText = 'ADICIONAR';
      }, 1000);
    };

    const updateSubtotal = (quantity) => {
      const priceElement = document.getElementById('price-kg');
      const price = parseFloat(priceElement.innerText.replace('R$', '').replace(',', '.'));

      const subtotalElement = document.getElementById('subtotal');
      subtotalElement.innerText = ('R$ ' + (price * quantity).toFixed(2)).replace('.', ',');
    };

    const addQuantity = () => {
      const quantityElement = document.getElementById('quantity');
      const quantity = parseInt(quantityElement.innerText) + 1;
      quantityElement.innerText = quantity;
      updateSubtotal(quantity);
    };

    const subQuantity = () => {
      const quantityElement = document.getElementById('quantity');
      const quantity = parseInt(quantityElement.innerText) - 1;

      if (quantity >= 0) {
        quantityElement.innerText = quantity;
        updateSubtotal(quantity);
      }
    };

    const logout = () => {
      delete localStorage['efruit:user'];
      delete localStorage['cart'];
      window.location.href = 'index.html';
    };
  </script>
</body>
</html>
